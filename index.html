<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <meta name="theme-color" content="#0F172A" />
  <title>AminLogic ‚Äî Speedometer & Trip Tracker</title>

  <!-- ‚úÖ Web + Android icons (served from your GitHub repo root) -->
  <link rel="icon" type="image/png" sizes="192x192" href="icon-192.png">
  <link rel="icon" type="image/png" sizes="512x512" href="icon-512.png">
  <link rel="apple-touch-icon" sizes="192xi91" href="icon-192.png">

  <style>
    :root{
      --bg0:#0B1220;
      --bg1:#0F172A;
      --card: rgba(255,255,255,.08);
      --stroke: rgba(255,255,255,.12);
      --text:#E5E7EB;
      --muted:#94A3B8;
      --accent:#6366F1;   /* indigo */
      --accent2:#22D3EE;  /* cyan */
      --good:#34D399;
      --warn:#FBBF24;
      --bad:#FB7185;
      --shadow: 0 18px 50px rgba(0,0,0,.45);
      --radius: 18px;
    }

    *{ box-sizing:border-box; }
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
      color:var(--text);
      background:
        radial-gradient(1200px 800px at 20% 10%, rgba(99,102,241,.18), transparent 55%),
        radial-gradient(900px 700px at 80% 15%, rgba(34,211,238,.14), transparent 55%),
        linear-gradient(180deg, var(--bg0), var(--bg1));
      min-height:100vh;
      padding: env(safe-area-inset-top) 0 env(safe-area-inset-bottom) 0;
    }

    .wrap{
      max-width: 980px;
      margin: 0 auto;
      padding: 18px 16px 90px;
    }

    /* Header */
    .topbar{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      margin-bottom: 16px;
    }
    .brand{
      display:flex;
      gap:12px;
      align-items:center;
      min-width: 0;
    }

    /* ‚úÖ Replaced plain blue square with real icon image */
    .logo{
      width:44px;
      height:44px;
      border-radius: 14px;
      box-shadow: var(--shadow);
      border: 1px solid rgba(255,255,255,.18);
      flex: 0 0 auto;
      object-fit: cover;
      background: rgba(255,255,255,.06);
      display:block;
    }

    .brand h1{
      font-size: 16px;
      margin:0;
      line-height: 1.2;
      letter-spacing: .2px;
      white-space: nowrap;
      overflow:hidden;
      text-overflow: ellipsis;
    }
    .brand p{
      margin:2px 0 0;
      font-size: 12px;
      color: var(--muted);
      white-space: nowrap;
      overflow:hidden;
      text-overflow: ellipsis;
    }

    .chiprow{
      display:flex;
      gap:8px;
      align-items:center;
      flex-wrap: wrap;
      justify-content:flex-end;
    }
    .chip{
      padding: 8px 10px;
      border-radius: 999px;
      background: rgba(255,255,255,.06);
      border: 1px solid rgba(255,255,255,.10);
      color: var(--muted);
      font-size: 12px;
    }
    .chip strong{ color: var(--text); font-weight: 600; }

    /* Cards */
    .card{
      background: var(--card);
      border: 1px solid var(--stroke);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      overflow:hidden;
    }
    .cardHeader{
      padding: 14px 14px 10px;
      border-bottom: 1px solid rgba(255,255,255,.08);
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:10px;
    }
    .cardHeader h2{
      margin:0;
      font-size: 14px;
      letter-spacing: .2px;
    }
    .sub{
      font-size: 12px;
      color: var(--muted);
      margin-top: 4px;
    }
    .cardBody{
      padding: 14px;
    }

    .row{
      display:flex;
      gap: 12px;
      flex-wrap: wrap;
    }
    .stat{
      flex: 1 1 160px;
      background: rgba(255,255,255,.06);
      border: 1px solid rgba(255,255,255,.10);
      border-radius: 16px;
      padding: 12px;
    }
    .stat .k{
      font-size: 12px;
      color: var(--muted);
      margin-bottom: 6px;
    }
    .stat .v{
      font-size: 26px;
      font-weight: 700;
      letter-spacing: .4px;
    }
    .stat .u{
      font-size: 12px;
      color: var(--muted);
      margin-top: 2px;
    }

    /* Big speed */
    .speedBox{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 12px;
    }
    .big{
      font-size: 48px;
      font-weight: 800;
      letter-spacing: .6px;
    }
    .unitPill{
      padding: 8px 10px;
      border-radius: 999px;
      background: rgba(99,102,241,.16);
      border: 1px solid rgba(99,102,241,.35);
      color: var(--text);
      font-size: 12px;
      white-space: nowrap;
    }

    .btnRow{
      display:flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-top: 12px;
    }
    button, .btn{
      appearance:none;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      color: var(--text);
      padding: 10px 12px;
      border-radius: 14px;
      font-weight: 600;
      font-size: 13px;
      cursor:pointer;
      transition: transform .06s ease, background .2s ease, border-color .2s ease;
      user-select:none;
      text-decoration:none;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap: 8px;
    }
    button:active, .btn:active{ transform: scale(.98); }
    .primary{
      background: linear-gradient(135deg, rgba(99,102,241,.95), rgba(34,211,238,.75));
      border-color: rgba(255,255,255,.22);
    }
    .ghost{
      background: transparent;
      border-color: rgba(255,255,255,.12);
      color: var(--muted);
    }
    .danger{
      background: rgba(251,113,133,.14);
      border-color: rgba(251,113,133,.35);
    }

    /* Form */
    label{
      display:block;
      font-size: 12px;
      color: var(--muted);
      margin-bottom: 6px;
    }
    input, select, textarea{
      width: 100%;
      background: rgba(255,255,255,.06);
      border: 1px solid rgba(255,255,255,.12);
      color: var(--text);
      padding: 11px 12px;
      border-radius: 14px;
      outline: none;
      font-size: 14px;
    }
    textarea{ resize: vertical; min-height: 86px; }
    input::placeholder, textarea::placeholder{ color: rgba(148,163,184,.7); }

    .formGrid{
      display:grid;
      grid-template-columns: 1fr;
      gap: 10px;
    }
    @media (min-width: 520px){
      .formGrid{ grid-template-columns: 1fr 1fr; }
      .span2{ grid-column: span 2; }
    }

    /* Tabs bottom nav */
    .nav{
      position: fixed;
      left: 0; right:0;
      bottom: 0;
      padding: 10px 12px calc(10px + env(safe-area-inset-bottom));
      background: rgba(8, 13, 25, .72);
      border-top: 1px solid rgba(255,255,255,.10);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
    }
    .navInner{
      max-width: 980px;
      margin: 0 auto;
      display:flex;
      gap: 10px;
    }
    .tab{
      flex:1 1 0;
      padding: 10px 10px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.05);
      color: var(--muted);
      font-size: 12px;
      font-weight: 700;
      letter-spacing: .2px;
      text-align:center;
      cursor:pointer;
      user-select:none;
    }
    .tab.active{
      color: var(--text);
      border-color: rgba(99,102,241,.45);
      background: rgba(99,102,241,.14);
    }

    .pill{
      font-size: 12px;
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.06);
      color: var(--muted);
      display:inline-flex;
      gap: 6px;
      align-items:center;
    }

    .note{
      color: var(--muted);
      font-size: 12px;
      line-height: 1.55;
    }

    .hr{
      height:1px;
      background: rgba(255,255,255,.10);
      margin: 12px 0;
    }

    .list{
      display:flex;
      flex-direction: column;
      gap: 10px;
    }
    .item{
      background: rgba(255,255,255,.06);
      border: 1px solid rgba(255,255,255,.10);
      border-radius: 16px;
      padding: 12px;
    }
    .itemTop{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap: 10px;
    }
    .itemTitle{
      margin:0;
      font-size: 14px;
      font-weight: 800;
    }
    .itemMeta{
      margin-top: 6px;
      font-size: 12px;
      color: var(--muted);
      line-height: 1.5;
    }

    .badge{
      font-size: 11px;
      font-weight: 800;
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.06);
      color: var(--text);
      white-space: nowrap;
    }
    .badge.good{ border-color: rgba(52,211,153,.35); background: rgba(52,211,153,.12); }
    .badge.warn{ border-color: rgba(251,191,36,.35); background: rgba(251,191,36,.12); }
    .badge.bad{ border-color: rgba(251,113,133,.35); background: rgba(251,113,133,.12); }

    .hidden{ display:none !important; }

    /* Small helper for WebView */
    .webviewHint{
      margin-top: 8px;
      font-size: 11px;
      color: rgba(148,163,184,.8);
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="topbar">
      <div class="brand">
        <!-- ‚úÖ Uses your uploaded icon image -->
        <img class="logo" src="icon-192.png" alt="AminLogic Speedometer Icon" />
        <div style="min-width:0">
          <h1>AminLogic ‚Äî Speedometer & Trip Tracker</h1>
          <p>Minimal driving utilities ‚Ä¢ Local-only trip planning</p>
        </div>
      </div>

      <div class="chiprow">
        <div class="chip">GPS: <strong id="gpsState">Idle</strong></div>
        <div class="chip">Accuracy: <strong id="accState">‚Äî</strong></div>
      </div>
    </div>

    <!-- SPEEDOMETER / TRACKER -->
    <section id="view-dashboard" class="card">
      <div class="cardHeader">
        <div>
          <h2>Live Speedometer</h2>
          <div class="sub">Uses device GPS speed when available</div>
        </div>
        <span class="pill" id="permHint">üìç Location required</span>
      </div>

      <div class="cardBody">
        <div class="speedBox">
          <div>
            <div class="big"><span id="speedVal">0</span></div>
            <div class="unitPill">
              Unit:
              <select id="unitSel" style="width:auto; display:inline-block; margin-left:8px; padding:6px 10px; border-radius:999px;">
                <option value="kmh" selected>km/h</option>
                <option value="mph">mph</option>
              </select>
            </div>
            <div class="webviewHint">Tip: If speed stays at 0, move outdoors or enable ‚ÄúHigh accuracy‚Äù location.</div>
          </div>

          <div class="stat" style="flex:0 1 240px; min-width: 220px;">
            <div class="k">Status</div>
            <div class="v" style="font-size:18px; font-weight:800" id="statusLine">Not tracking</div>
            <div class="u" id="statusSub">Press Start to begin</div>
          </div>
        </div>

        <div class="hr"></div>

        <div class="row">
          <div class="stat">
            <div class="k">Session distance</div>
            <div class="v"><span id="distVal">0.00</span></div>
            <div class="u"><span id="distUnit">km</span></div>
          </div>
          <div class="stat">
            <div class="k">Max speed</div>
            <div class="v"><span id="maxVal">0</span></div>
            <div class="u"><span id="maxUnit">km/h</span></div>
          </div>
          <div class="stat">
            <div class="k">Elapsed</div>
            <div class="v"><span id="timeVal">00:00</span></div>
            <div class="u">mm:ss</div>
          </div>
        </div>

        <div class="btnRow">
          <button class="primary" id="btnStart">‚ñ∂ Start</button>
          <button class="ghost" id="btnPause" disabled>‚è∏ Pause</button>
          <button class="danger" id="btnReset" disabled>‚Ü∫ Reset</button>
        </div>

        <div class="hr"></div>

        <div class="note">
          <strong>Disclaimer:</strong> This app provides <em>speed and trip tracking utilities only</em>.
          It does not offer transportation services, drivers, ride-hailing, or paid bookings.
        </div>
      </div>
    </section>

    <!-- TRIP PLANNER -->
    <section id="view-planner" class="card hidden">
      <div class="cardHeader">
        <div>
          <h2>Trip Planner</h2>
          <div class="sub">Save journeys locally ‚Äî planning only</div>
        </div>
        <span class="pill">üóìÔ∏è Plan ‚Ä¢ Save ‚Ä¢ Repeat</span>
      </div>

      <div class="cardBody">
        <form id="tripForm">
          <div class="formGrid">
            <div>
              <label for="tripName">Trip name</label>
              <input id="tripName" placeholder="Morning commute" required />
            </div>
            <div>
              <label for="vehicle">Vehicle</label>
              <select id="vehicle">
                <option>Car</option>
                <option>Motorcycle</option>
                <option>Bicycle</option>
                <option>Walking</option>
                <option>Other</option>
              </select>
            </div>

            <div class="span2">
              <label for="startLoc">Start location</label>
              <input id="startLoc" placeholder="Start (e.g., Home)" />
            </div>

            <div class="span2">
              <label for="endLoc">Destination</label>
              <input id="endLoc" placeholder="Destination (e.g., Work)" />
            </div>

            <div>
              <label for="date">Date</label>
              <input id="date" type="date" />
            </div>
            <div>
              <label for="time">Time</label>
              <input id="time" type="time" />
            </div>

            <div class="span2">
              <label for="notes">Notes (optional)</label>
              <textarea id="notes" placeholder="Parking, tolls, reminders‚Ä¶"></textarea>
            </div>
          </div>

          <div class="btnRow">
            <button class="primary" type="submit">üíæ Save Trip</button>
            <button class="ghost" type="button" id="btnUseCurrent">üìç Use current GPS as Start</button>
          </div>

          <div class="webviewHint">
            Trips are stored on this device only. No accounts, no payments, no drivers.
          </div>
        </form>
      </div>
    </section>

    <!-- HISTORY -->
    <section id="view-history" class="card hidden">
      <div class="cardHeader">
        <div>
          <h2>Trip History</h2>
          <div class="sub">Your saved trips (local-only)</div>
        </div>
        <button class="danger" id="btnClearTrips">üóë Clear</button>
      </div>

      <div class="cardBody">
        <div id="emptyState" class="note">No trips saved yet. Create one in Trip Planner.</div>
        <div id="tripList" class="list"></div>
      </div>
    </section>

    <!-- PRO -->
    <section id="view-pro" class="card hidden">
      <div class="cardHeader">
        <div>
          <h2>AminLogic Pro</h2>
          <div class="sub">Connect this page to your Kodular In-App Purchase</div>
        </div>
        <span class="pill">‚ú® Premium</span>
      </div>

      <div class="cardBody">
        <div class="row">
          <div class="stat">
            <div class="k">Pro unlock</div>
            <div class="v" style="font-size:18px">Remove ads</div>
            <div class="u">Cleaner experience</div>
          </div>
          <div class="stat">
            <div class="k">Pro unlock</div>
            <div class="v" style="font-size:18px">Unlimited trip saves</div>
            <div class="u">No limits</div>
          </div>
          <div class="stat">
            <div class="k">Pro unlock</div>
            <div class="v" style="font-size:18px">Extra stats</div>
            <div class="u">More insights</div>
          </div>
        </div>

        <div class="hr"></div>

        <div class="note">
          In Kodular, trigger your IAP natively. After purchase, remove ads and unlock features.
        </div>

        <div class="btnRow">
          <a class="btn primary" href="#" onclick="alert('Trigger your Kodular IAP here (native).'); return false;">üîì Unlock Pro (Native IAP)</a>
          <a class="btn ghost" href="#" onclick="alert('Add your support link / privacy policy here.'); return false;">‚ÑπÔ∏è About AminLogic</a>
        </div>

        <div class="hr"></div>
        <div class="note">
          <strong>Policy-safe note:</strong> This app is a driving utility. No ride-hailing, no booking payments, no drivers.
        </div>
      </div>
    </section>

    <!-- ‚úÖ Footer cleaned: removed the oaicite/contentReference text completely -->
    <div class="webviewHint" style="margin-top:14px;">
      ¬© <span id="year"></span> AminLogic ‚Ä¢ aminlogic.com
    </div>
  </div>

  <!-- Bottom nav -->
  <div class="nav">
    <div class="navInner">
      <div class="tab active" data-view="dashboard">Speed</div>
      <div class="tab" data-view="planner">Planner</div>
      <div class="tab" data-view="history">History</div>
      <div class="tab" data-view="pro">Pro</div>
    </div>
  </div>

  <script>
    // ======== Simple UI router (tabs) ========
    const views = {
      dashboard: document.getElementById("view-dashboard"),
      planner: document.getElementById("view-planner"),
      history: document.getElementById("view-history"),
      pro: document.getElementById("view-pro")
    };

    document.querySelectorAll(".tab").forEach(tab => {
      tab.addEventListener("click", () => {
        document.querySelectorAll(".tab").forEach(t => t.classList.remove("active"));
        tab.classList.add("active");

        Object.values(views).forEach(v => v.classList.add("hidden"));
        const key = tab.getAttribute("data-view");
        views[key].classList.remove("hidden");

        if(key === "history") renderTrips();
      });
    });

    // ======== Speedometer + Distance Tracker ========
    const gpsState = document.getElementById("gpsState");
    const accState = document.getElementById("accState");
    const permHint = document.getElementById("permHint");

    const speedVal = document.getElementById("speedVal");
    const unitSel = document.getElementById("unitSel");

    const distVal = document.getElementById("distVal");
    const distUnit = document.getElementById("distUnit");

    const maxVal = document.getElementById("maxVal");
    const maxUnit = document.getElementById("maxUnit");

    const timeVal = document.getElementById("timeVal");

    const statusLine = document.getElementById("statusLine");
    const statusSub = document.getElementById("statusSub");

    const btnStart = document.getElementById("btnStart");
    const btnPause = document.getElementById("btnPause");
    const btnReset = document.getElementById("btnReset");

    let watchId = null;
    let paused = false;

    let lastPos = null;
    let totalMeters = 0;

    let maxSpeedMS = 0;

    let startTime = null;
    let elapsedInterval = null;

    function msToUnit(ms, unit){
      if(unit === "mph") return ms * 2.2369362920544;
      return ms * 3.6; // km/h
    }

    function metersToUnit(m, unit){
      if(unit === "mph") return m / 1609.344; // miles
      return m / 1000; // km
    }

    function fmtTime(sec){
      const m = Math.floor(sec/60);
      const s = sec % 60;
      return String(m).padStart(2,"0") + ":" + String(s).padStart(2,"0");
    }

    function haversineMeters(a, b){
      const R = 6371000;
      const toRad = (d) => d * Math.PI/180;
      const dLat = toRad(b.lat - a.lat);
      const dLon = toRad(b.lon - a.lon);
      const lat1 = toRad(a.lat);
      const lat2 = toRad(b.lat);

      const h =
        Math.sin(dLat/2) * Math.sin(dLat/2) +
        Math.cos(lat1) * Math.cos(lat2) *
        Math.sin(dLon/2) * Math.sin(dLon/2);

      return 2 * R * Math.asin(Math.min(1, Math.sqrt(h)));
    }

    function setStatus(main, sub){
      statusLine.textContent = main;
      statusSub.textContent = sub || "";
    }

    function updateUI(speedMS, accuracy){
      const unit = unitSel.value;

      const val = Math.max(0, msToUnit(speedMS || 0, unit));
      speedVal.textContent = Math.round(val);

      const d = metersToUnit(totalMeters, unit);
      distVal.textContent = d.toFixed(2);
      distUnit.textContent = (unit === "mph") ? "mi" : "km";

      const maxU = msToUnit(maxSpeedMS, unit);
      maxVal.textContent = Math.round(maxU);
      maxUnit.textContent = (unit === "mph") ? "mph" : "km/h";

      if(typeof accuracy === "number"){
        accState.textContent = Math.round(accuracy) + " m";
      }
    }

    function startTimer(){
      if(elapsedInterval) clearInterval(elapsedInterval);
      elapsedInterval = setInterval(() => {
        if(!startTime) return;
        const sec = Math.floor((Date.now() - startTime) / 1000);
        timeVal.textContent = fmtTime(sec);
      }, 500);
    }

    function onPos(pos){
      if(paused) return;

      permHint.textContent = "üìç Location active";
      gpsState.textContent = "On";

      const { latitude, longitude, accuracy, speed } = pos.coords;
      accState.textContent = (accuracy != null) ? (Math.round(accuracy) + " m") : "‚Äî";

      const cur = { lat: latitude, lon: longitude };
      const speedMS = (typeof speed === "number" && speed >= 0) ? speed : 0;

      if(speedMS > maxSpeedMS) maxSpeedMS = speedMS;

      if(lastPos){
        const delta = haversineMeters(lastPos, cur);
        if(delta < 250) totalMeters += delta;
      }
      lastPos = cur;

      updateUI(speedMS, accuracy);
      setStatus("Tracking", "Drive safely ‚Ä¢ AminLogic");
    }

    function onErr(err){
      gpsState.textContent = "Off";
      permHint.textContent = "üìç Location blocked";
      setStatus("Location error", (err && err.message) ? err.message : "Enable GPS permission");
    }

    function beginWatch(){
      if(!navigator.geolocation){
        setStatus("Not supported", "Geolocation not available");
        return;
      }

      watchId = navigator.geolocation.watchPosition(
        onPos,
        onErr,
        { enableHighAccuracy: true, maximumAge: 1000, timeout: 15000 }
      );
    }

    btnStart.addEventListener("click", () => {
      paused = false;
      btnStart.disabled = true;
      btnPause.disabled = false;
      btnReset.disabled = false;

      if(!startTime) startTime = Date.now();
      startTimer();

      beginWatch();
      setStatus("Starting‚Ä¶", "Waiting for GPS signal");
    });

    btnPause.addEventListener("click", () => {
      paused = !paused;
      btnPause.textContent = paused ? "‚ñ∂ Resume" : "‚è∏ Pause";
      setStatus(paused ? "Paused" : "Tracking", paused ? "Tracking paused" : "Drive safely ‚Ä¢ AminLogic");
    });

    btnReset.addEventListener("click", () => {
      paused = false;
      btnPause.textContent = "‚è∏ Pause";

      totalMeters = 0;
      maxSpeedMS = 0;
      lastPos = null;

      startTime = Date.now();
      timeVal.textContent = "00:00";

      updateUI(0, null);
      setStatus("Reset", "Fresh session started");
    });

    unitSel.addEventListener("change", () => {
      updateUI(0, null);
    });

    // ======== Trip Planner + History (localStorage) ========
    const tripForm = document.getElementById("tripForm");
    const tripList = document.getElementById("tripList");
    const emptyState = document.getElementById("emptyState");
    const btnClearTrips = document.getElementById("btnClearTrips");
    const btnUseCurrent = document.getElementById("btnUseCurrent");

    const LS_KEY = "aminlogic_trips_v1";

    function loadTrips(){
      try{
        const raw = localStorage.getItem(LS_KEY);
        if(!raw) return [];
        const arr = JSON.parse(raw);
        return Array.isArray(arr) ? arr : [];
      }catch(e){
        return [];
      }
    }

    function saveTrips(trips){
      localStorage.setItem(LS_KEY, JSON.stringify(trips));
    }

    function badgeForTrip(t){
      const hasDT = (t.date && t.time);
      if(hasDT) return { cls:"good", txt:"Scheduled" };
      if(t.date || t.time) return { cls:"warn", txt:"Planned" };
      return { cls:"bad", txt:"Draft" };
    }

    function escapeHtml(str){
      return String(str).replace(/[&<>"']/g, s => ({
        "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"
      }[s]));
    }

    function cryptoRandomId(){
      try{
        const a = new Uint8Array(8);
        crypto.getRandomValues(a);
        return Array.from(a).map(x => x.toString(16).padStart(2,"0")).join("");
      }catch(e){
        return String(Date.now()) + "_" + Math.random().toString(16).slice(2);
      }
    }

    function renderTrips(){
      const trips = loadTrips().sort((a,b) => (b.createdAt||0) - (a.createdAt||0));
      tripList.innerHTML = "";

      if(trips.length === 0){
        emptyState.classList.remove("hidden");
        return;
      }
      emptyState.classList.add("hidden");

      for(const t of trips){
        const b = badgeForTrip(t);

        const div = document.createElement("div");
        div.className = "item";

        const top = document.createElement("div");
        top.className = "itemTop";

        const left = document.createElement("div");
        const h = document.createElement("p");
        h.className = "itemTitle";
        h.textContent = t.name || "Trip";

        const meta = document.createElement("div");
        meta.className = "itemMeta";
        const dt = [t.date, t.time].filter(Boolean).join(" ");
        meta.innerHTML =
          `<div><strong>Vehicle:</strong> ${escapeHtml(t.vehicle || "‚Äî")}</div>` +
          `<div><strong>Start:</strong> ${escapeHtml(t.start || "‚Äî")}</div>` +
          `<div><strong>Destination:</strong> ${escapeHtml(t.end || "‚Äî")}</div>` +
          (dt ? `<div><strong>When:</strong> ${escapeHtml(dt)}</div>` : "") +
          (t.notes ? `<div style="margin-top:6px"><strong>Notes:</strong> ${escapeHtml(t.notes)}</div>` : "");

        left.appendChild(h);
        left.appendChild(meta);

        const right = document.createElement("span");
        right.className = "badge " + b.cls;
        right.textContent = b.txt;

        top.appendChild(left);
        top.appendChild(right);

        const actions = document.createElement("div");
        actions.className = "btnRow";
        actions.style.marginTop = "10px";

        const del = document.createElement("button");
        del.className = "danger";
        del.type = "button";
        del.textContent = "Delete";
        del.addEventListener("click", () => {
          const all = loadTrips();
          const next = all.filter(x => x.id !== t.id);
          saveTrips(next);
          renderTrips();
        });

        actions.appendChild(del);

        div.appendChild(top);
        div.appendChild(actions);

        tripList.appendChild(div);
      }
    }

    tripForm.addEventListener("submit", (e) => {
      e.preventDefault();

      const trip = {
        id: cryptoRandomId(),
        createdAt: Date.now(),
        name: document.getElementById("tripName").value.trim(),
        vehicle: document.getElementById("vehicle").value,
        start: document.getElementById("startLoc").value.trim(),
        end: document.getElementById("endLoc").value.trim(),
        date: document.getElementById("date").value,
        time: document.getElementById("time").value,
        notes: document.getElementById("notes").value.trim()
      };

      const trips = loadTrips();
      trips.push(trip);
      saveTrips(trips);

      tripForm.reset();
      alert("Trip saved locally ‚úÖ");

      document.querySelector('.tab[data-view="history"]').click();
    });

    btnClearTrips.addEventListener("click", () => {
      if(confirm("Clear all saved trips on this device?")){
        localStorage.removeItem(LS_KEY);
        renderTrips();
      }
    });

    btnUseCurrent.addEventListener("click", () => {
      if(!navigator.geolocation){
        alert("Geolocation not supported.");
        return;
      }
      navigator.geolocation.getCurrentPosition((pos) => {
        const { latitude, longitude } = pos.coords;
        const text = `${latitude.toFixed(6)}, ${longitude.toFixed(6)}`;
        document.getElementById("startLoc").value = text;
        alert("Set Start location to current GPS.");
      }, (err) => {
        alert(err && err.message ? err.message : "Location permission needed.");
      }, { enableHighAccuracy:true, timeout: 12000 });
    });

    // init
    document.getElementById("year").textContent = new Date().getFullYear();
    updateUI(0, null);
    setStatus("Not tracking", "Press Start to begin");
  </script>
</body>
</html>
